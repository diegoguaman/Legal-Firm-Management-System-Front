<div class="client-form-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <mat-icon>{{ isEditMode ? 'edit' : 'person_add' }}</mat-icon>
        {{ isEditMode ? 'Editar Cliente' : 'Nuevo Cliente' }}
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="clientForm" (ngSubmit)="onSubmit()">
        <!-- Loading State -->
        @if (loading$ | async) {
          <div class="loading-overlay">
            <mat-spinner diameter="50"></mat-spinner>
          </div>
        }

        <div class="form-grid">
          <!-- Personal Information Section -->
          <div class="form-section">
            <h3>Información Personal</h3>
            
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>DNI/NIE</mat-label>
              <input matInput formControlName="dni_nie" placeholder="12345678A">
              <mat-hint>Documento de identidad del cliente</mat-hint>
              @if (hasError('dni_nie')) {
                <mat-error>
                  {{ getErrorMessage('dni_nie') }}
                </mat-error>
              }
            </mat-form-field>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Nombre</mat-label>
                <input matInput formControlName="first_name" placeholder="Juan">
                @if (hasError('first_name')) {
                  <mat-error>
                    {{ getErrorMessage('first_name') }}
                  </mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Apellidos</mat-label>
                <input matInput formControlName="last_name" placeholder="Pérez García">
                @if (hasError('last_name')) {
                  <mat-error>
                    {{ getErrorMessage('last_name') }}
                  </mat-error>
                }
              </mat-form-field>
            </div>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Tipo de Cliente</mat-label>
              <mat-select formControlName="client_type">
                @for (type of clientTypes; track type.value) {
                  <mat-option [value]="type.value">
                    {{ type.label }}
                  </mat-option>
                }
              </mat-select>
              @if (hasError('client_type')) {
                <mat-error>
                  {{ getErrorMessage('client_type') }}
                </mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Nacionalidad</mat-label>
              <input matInput formControlName="nationality" placeholder="Española">
            </mat-form-field>
          </div>

          <!-- Contact Information Section -->
          <div class="form-section">
            <h3>Información de Contacto</h3>
            
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Teléfono</mat-label>
              <input matInput formControlName="phone" placeholder="+34 612 345 678">
              <mat-hint>Formato: +34 612 345 678</mat-hint>
              @if (hasError('phone')) {
                <mat-error>
                  {{ getErrorMessage('phone') }}
                </mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Email</mat-label>
              <input matInput formControlName="email" type="email" placeholder="cliente@example.com">
              @if (hasError('email')) {
                <mat-error>
                  {{ getErrorMessage('email') }}
                </mat-error>
              }
            </mat-form-field>
          </div>

          <!-- Address Information Section -->
          <div class="form-section">
            <h3>Dirección</h3>
            
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Calle</mat-label>
              <input matInput formControlName="address_street" placeholder="Calle Mayor 123">
            </mat-form-field>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Ciudad</mat-label>
                <input matInput formControlName="address_city" placeholder="Madrid">
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Provincia</mat-label>
                <input matInput formControlName="address_province" placeholder="Madrid">
              </mat-form-field>
            </div>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Código Postal</mat-label>
              <input matInput formControlName="address_zip" placeholder="28001" maxlength="5">
              @if (hasError('address_zip')) {
                <mat-error>
                  {{ getErrorMessage('address_zip') }}
                </mat-error>
              }
            </mat-form-field>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="button" mat-button (click)="onCancel()">
            <mat-icon>cancel</mat-icon>
            Cancelar
          </button>
          <button type="submit" mat-raised-button color="primary" [disabled]="clientForm.invalid || (loading$ | async)">
            <mat-icon>{{ isEditMode ? 'save' : 'add' }}</mat-icon>
            {{ isEditMode ? 'Guardar Cambios' : 'Crear Cliente' }}
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>

